define(["jquery","underscore","loglevel","handlebars"],function(e,o,t,r){return function(e){function o(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var t={};return o.m=e,o.c=t,o.p="",o(0)}([function(e,o,t){e.exports=t(1)},function(e,o,t){var r,n;r=[t(2),t(3),t(4),t(5),t(6),t(7)],n=function(e,o,t,r,n,i){"use strict";function s(){return this}return s.prototype.compileFilter=function(e,t,i){r.extend(this,o);var s=i[e]||{},a=s.format||{},c=a.template,u=a.output||"codes";if(c)return this.compileTemplate(e,t,s,c);var l,d=a.dimension||e;switch(u.toLocaleLowerCase()){case"codes":return l='{ "codes":[{"uid": "{{{uid}}}", "version": "{{version}}", "codes": [{{{codes}}}] } ]}',this.compileTemplate(e,t,s,d,l);case"time":return this.createTimeFilter(e,t,s,d);case"enumeration":return this.createEnumerationFilter(e,t,s,d);default:return n.warn(e+" not included in the result set. Missing format configuration."),{}}},s.prototype.compileTemplate=function(e,o,t,s,a){var c=r.extend(t.cl,t.format,{codes:'"'+o.join('","')+'"'});if(a||n.error("Impossible to find '"+e+"' process template. Check your '"+e+"'.filter.process configuration."),!c.uid)return void n.error("Impossible to find '"+e+"' code list configuration for FENIX output format export.");var u=i.compile(a),l=JSON.parse(u(c)),d=l.codes;return r.each(d,function(e){e.version||delete e.version}),l},s.prototype.createTimeFilter=function(e,o,n,i){var s,a=[],c="object"==typeof o[0];if(c){var u=r.findWhere(o,{parent:"from"})||{},l=r.findWhere(o,{parent:"to"})||{},d={from:null,to:null};d.from=u.value,d.to=l.value,a.push(t.extend({},d))}else s=o.map(function(e){return parseInt(e,10)}).sort(function(e,o){return e-o}),r.each(s,function(e){a.push({from:e,to:e})});return{time:a}},s.prototype.createEnumerationFilter=function(e,o,t,r){return{enumeration:o}},s.prototype.cleanArray=function(e){for(var o=[],t=0;t<e.length;t++)e[t]&&o.push(e[t]);return o},s.prototype.createConfiguration=function(t){n.info("Create filter configuration from:"),n.info(t),r.extend(this,o,t);var i={};return this._isFenixResource(t.model)===!0?(n.info("Valid resource"),r.each(t.model.metadata.dsd.columns,r.bind(function(e){r.contains(this.forbiddenSubjects,e.subject)||r.contains(this.exclude,e.id)||e.id.endsWith("_"+this.lang.toUpperCase())?n.warn(e.id+" was excluded. [id: "+e.id+", subject: "+e.subject+"]"):i[e.id]=r.extend({},this._processFxColumn(e),this.common)},this))):n.error(e.INVALID_FENIX_RESOURCE),i},s.prototype.mergeConfigurations=function(e,o){var t=o.toolbar?o.toolbar:o;if(t){var n=t.values;r.each(n,r.bind(function(o,t){e.hasOwnProperty(t)&&(e[t].selector["default"]=n[t])},this))}return e},s.prototype._processFxColumn=function(o){var t={};if(this._isFenixColumn(o)===!0)switch(n.info("Valid column with dataType: "+o.dataType.toLowerCase()+" [column.id = "+o.id+" ]"),o.dataType.toLowerCase()){case"customcode":t=this._processCustomCodeColumn(o);break;case"enumeration":t=this._processEnumerationColumn(o);break;case"code":t=this._processCodeColumn(o);break;case"date":t=this._processDateColumn(o);break;case"month":t=this._processMonthColumn(o);break;case"year":t=this._processYearColumn(o);break;case"time":t=this._processTimeColumn(o);break;case"text":t=this._processTextColumn(o);break;case"label":t=this._processLabelColumn(o);break;case"number":t=this._processNumberColumn(o);break;case"percentage":t=this._processPercentageColumn(o);break;case"bool":t=this._processBooleanColumn(o);break;default:n.error(e.UNKNOWN_FENIX_COLUMN_DATATYPE,o.dataType.toLowerCase())}else n.error(e.INVALID_FENIX_COLUMN);return r.extend({},t,this._commonProcessColumn(o))},s.prototype._processCustomCodeColumn=function(e){return this._configTreeFromSource(e)},s.prototype._processEnumerationColumn=function(e){var o={},t=e.domain||{},n=t.enumeration||[];return o.selector={},o.selector.id="tree",o.selector.hideFilter=!0,o.selector.source=r.map(n,function(e){return{value:e,label:e}}),o},s.prototype._processCodeColumn=function(e){return this._configTreeFromCodelist(e)},s.prototype._processDateColumn=function(e){var o=e.domain||{},t=o.period,r=o.timeList;return t&&t.from&&t.to?this._configTimeFromPeriod(e):r?this._configTreeFromTimelist(e):(n.warn("Impossible to find process for column "+e.id),{})},s.prototype._processMonthColumn=function(e){return this._configTemporalColumn(e)},s.prototype._processYearColumn=function(e){return this._configTemporalColumn(e)},s.prototype._processTimeColumn=function(e){return this._configTemporalColumn(e)},s.prototype._processTextColumn=function(e){return this._configInput(e,{type:"text"})},s.prototype._processLabelColumn=function(e){return this._configInput(e,{type:"text"})},s.prototype._processNumberColumn=function(e){return this._configInput(e,{type:"number",output:"time"})},s.prototype._processPercentageColumn=function(e){n.warn("TODO process")},s.prototype._processBooleanColumn=function(e){return this._configInput(e,{type:"checkbox"})},s.prototype._commonProcessColumn=function(e){var o={template:{},format:{dimension:e.id}};return e.title&&e.title[this.lang.toUpperCase()]&&(o.template.title=e.title[this.lang.toUpperCase()]),o},s.prototype._configTreeFromCodelist=function(e){var o,t={},r=e.domain||{},i=r.codes;return(!Array.isArray(i)||i.length>1)&&n.warn("Invalid domain.codes attributes"),o=i[0],o.idCodeList||n.error("Impossible to find idCodeList"),t.cl={},t.cl.uid=o.idCodeList,t.cl.version=o.version,t.selector={},t.selector.id="tree",t.selector.lazy=!0,t.selector.hideFilter=!0,t},s.prototype._configTreeFromSource=function(e){var o,t={},i=e.domain||{},s=i.codes;return(!Array.isArray(s)||s.length>1)&&n.warn("Invalid domain.codes attributes"),o=s[0],o.codes||n.error("Impossible to find codes"),t.selector={},t.selector.id="tree",t.selector.source=r.map(o.codes,r.bind(function(e){return{value:e.code,label:e.label[this.lang.toUpperCase()]}},this)),t.selector.hideFilter=!0,t},s.prototype._configDropdownFromPeriod=function(e){var o={},t=e.domain||{},r=t.period;return o.selector={},o.selector.id="dropdown",o.selector.from=r.from,o.selector.to=r.to,o},s.prototype._configTreeFromPeriod=function(e){var o={},t=e.domain||{},r=t.period;return o.selector={},o.selector.id="tree",o.selector.from=r.from,o.selector.to=r.to,o.selector.hideFilter=!0,o},s.prototype._configDropdownFromTimelist=function(e){var o={},t=e.domain||{},n=t.timeList||[],i=this._getTimeFormat(n[0]);return o.selector={},o.selector.id="dropdown",o.selector.source=r.map(n,r.bind(function(e){return{value:e,label:new Moment(e,i).format(this._getTimeLabelFormat(e))}},this)),o},s.prototype._configTreeFromTimelist=function(e){var o={},t=e.domain||{},n=t.timeList||[],i=this._getTimeFormat(n[0]);return o.selector={},o.selector.id="tree",o.selector.source=r.map(n,r.bind(function(e){return{value:e,label:new Moment(e,i).format(this._getTimeLabelFormat(e))}},this)),o.selector.hideFilter=!0,o},s.prototype._configDropdownFromSource=function(e){var o,t={},i=e.domain||{},s=i.codes;return(!Array.isArray(s)||s.length>1)&&n.warn("Invalid domain.codes attributes"),o=s[0],o.codes||n.error("Impossible to find codes"),t.selector={},t.selector.id="dropdown",t.selector.source=r.map(o.codes,r.bind(function(e){return{value:e.code,label:e.label[this.lang.toUpperCase()]}},this)),t},s.prototype._configDropdownFromCodelist=function(e){var o,t={},r=e.domain||{},i=r.codes;return(!Array.isArray(i)||i.length>1)&&n.warn("Invalid domain.codes attributes"),o=i[0],o.idCodeList||n.error("Impossible to find idCodeList"),t.cl={},t.cl.uid=o.idCodeList,t.cl.version=o.version,t.selector={},t.selector.id="dropdown",t},s.prototype._configTimeFromPeriod=function(e){var o={},t=e.domain||{},r=t.period,n=String(r.from),i=String(r.to);return o.selector={config:{}},o.selector.id="tree",o.selector.from=parseInt(n,10),o.selector.to=parseInt(i,10),o.selector.hideFilter=!0,o.format={output:"time"},o},s.prototype._configRangeFromPeriod=function(e){var o={},t=e.domain||{},r=t.period;return o.selector={config:{}},o.selector.id="range",o.selector.config.min=r.from,o.selector.config.max=r.to,o.selector.config.type="double",o.selector.config.prettify_enabled=!1,o},s.prototype._configInput=function(e,o){var t={selector:{},format:{output:o.output||"enumeration"}};return t.selector.id="input",t.selector.type=o.type||"text",t},s.prototype._configTemporalColumn=function(e){var t=e.domain||{},r=t.period,i=t.timeList;return r&&r.from&&r.to?this._configTreeFromPeriod(e):i?this._configTreeFromTimelist(e):(n.warn("Column "+e.id+" set with default time period range."),e.domain={period:{from:o.defaultPeriodFrom,to:o.defaultPeriodTo}},this._configTimeFromPeriod(e))},s.prototype._getTimeFormat=function(e){var o;switch(String(e).length){case 4:o="YYYY";break;case 6:o="YYYY MM";break;case 8:o="YYYY MM DD";break;case 12:o="YYYY MM DD hh mm";break;case 14:o="YYYY MM DD hh mm ss";break;default:n.warn("Impossible to find time format for: "+o)}return o},s.prototype._getTimeLabelFormat=function(e){if(this.timeLabelFormat)return this.timeLabelFormat;var o;switch(String(e).length){case 4:o="YYYY";break;case 6:o="L";break;case 8:o="L";break;case 14:o="lll";break;default:n.warn("Impossible to find time label format for: "+o)}return o},s.prototype._isFenixResource=function(o){var t=!0,r=[],n=this.getNestedProperty("metadata.meContent.resourceRepresentationType",o);return o.hasOwnProperty("metadata")||(r.push({code:e.INVALID_METADATA}),t=!1),t&&!o.metadata.hasOwnProperty("dsd")&&(r.push({code:e.INVALID_DSD}),t=!1),"dataset"!==n||!t||o.metadata.dsd.hasOwnProperty("columns")&&Array.isArray(o.metadata.dsd.columns)||r.push({code:e.INVALID_COLUMNS}),r.length>0?r:t},s.prototype._isFenixColumn=function(o){var t=!0,r=[];return o.hasOwnProperty("dataType")||(r.push({code:e.INVALID_COLUMN_DATATYPE}),t=!1),r.length>0?r:t},s.prototype.getNestedProperty=function(e,o){for(var o=r.extend({},o),t=e.split(".");t.length&&(o=o[t.shift()]););return o},new s}.apply(o,r),!(void 0!==n&&(e.exports=n))},function(e,o,t){var r;r=function(){"use strict";var e="";return{INVALID_FENIX_RESOURCE:e+"invalid_fenix_resource",INVALID_METADATA:e+"invalid_metadata",INVALID_DSD:e+"invalid_dsd",INVALID_COLUMNS:e+"invalid_dsd",INVALID_FENIX_COLUMN:e+"invalid_fenix_column",INVALID_COLUMN_DATATYPE:e+"invalid_column_datatype",UNKNOWN_FENIX_COLUMN_DATATYPE:e+"unknown_fenix_column_datatype"}}.call(o,t,o,e),!(void 0!==r&&(e.exports=r))},function(e,o,t){var r;r=function(){"use strict";return{forbiddenSubjects:["value"],exclude:[],common:{},lang:"EN",defaultPeriodFrom:1970,defaultPeriodTo:2017}}.call(o,t,o,e),!(void 0!==r&&(e.exports=r))},function(o,t){o.exports=e},function(e,t){e.exports=o},function(e,o){e.exports=t},function(e,o){e.exports=r}])});
//# sourceMappingURL=fenix-ui-filter-utils.min.js.map