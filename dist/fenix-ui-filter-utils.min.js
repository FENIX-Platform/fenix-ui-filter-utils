define(["jquery","underscore","loglevel","handlebars","moment"],function(e,t,o,r,n){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){var r,n;r=[o(2),o(3),o(4),o(5),o(6),o(7),o(8)],n=function(e,t,o,r,n,i,s){"use strict";function a(){return this}return a.prototype.compileFilter=function(e,r,i){o.extend(!0,this,t);var s=i[e]||{},a=s.format||{},c=a.template,u=a.output||"codes";if(c)return this.compileTemplate(e,r,s,c);var l,d=a.dimension||e;switch(u.toLocaleLowerCase()){case"codes":return l='{ "codes":[{"uid": "{{{uid}}}", "version": "{{version}}", "codes": [{{{codes}}}] } ]}',this.compileTemplate(e,r,s,d,l);case"time":return this.createTimeFilter(e,r,s,d);case"enumeration":return this.createEnumerationFilter(e,r,s,d);default:return n.warn(e+" not included in the result set. Missing format configuration."),{}}},a.prototype.compileTemplate=function(e,t,s,a,c){var u=o.extend(!0,s.cl,s.format,{codes:'"'+t.join('","')+'"'});if(c||n.error("Impossible to find '"+e+"' process template. Check your '"+e+"'.filter.process configuration."),!u.uid)return void n.error("Impossible to find '"+e+"' code list configuration for FENIX output format export.");var l=i.compile(c),d=JSON.parse(l(u)),p=d.codes;return r.each(p,function(e){e.version||delete e.version}),d},a.prototype.createTimeFilter=function(e,t,n,i){var s,a=[],c="object"==typeof t[0];if(c){var u=r.findWhere(t,{parent:"from"})||{},l=r.findWhere(t,{parent:"to"})||{},d={from:null,to:null};d.from=u.value,d.to=l.value,a.push(o.extend({},d))}else s=t.map(function(e){return parseInt(e,10)}).sort(function(e,t){return e-t}),r.each(s,function(e){a.push({from:e,to:e})});return{time:a}},a.prototype.createEnumerationFilter=function(e,t,o,r){return{enumeration:t}},a.prototype.cleanArray=function(e){for(var t=[],o=0;o<e.length;o++)e[o]&&t.push(e[o]);return t},a.prototype.createConfiguration=function(i){n.info("Create filter configuration from:"),n.info(i),o.extend(!0,this,t,i);var s={};return this._isFenixResource(i.model)===!0?(n.info("Valid resource"),r.each(i.model.metadata.dsd.columns,r.bind(function(e){r.contains(this.forbiddenSubjects,e.subject)||r.contains(this.exclude,e.id)||e.id.endsWith("_"+this.lang.toUpperCase())?n.warn(e.id+" was excluded. [id: "+e.id+", subject: "+e.subject+"]"):s[e.id]=o.extend(!0,{},this._processFxColumn(e,i.model.metadata),this.common)},this))):n.error(e.INVALID_FENIX_RESOURCE),s},a.prototype.mergeConfigurations=function(e,t){var o=t.toolbar?t.toolbar:t;if(o){var n=o.values;r.each(n,r.bind(function(t,o){e.hasOwnProperty(o)&&(e[o].selector["default"]=n[o])},this))}return e},a.prototype._processFxColumn=function(t,r){var i={};if(this._isFenixColumn(t)===!0)switch(n.info("Valid column with dataType: "+t.dataType.toLowerCase()+" [column.id = "+t.id+" ]"),t.dataType.toLowerCase()){case"customcode":i=this._processCustomCodeColumn(t);break;case"enumeration":i=this._processEnumerationColumn(t);break;case"code":i=this._processCodeColumn(t,r);break;case"date":i=this._processDateColumn(t);break;case"month":i=this._processMonthColumn(t);break;case"year":i=this._processYearColumn(t);break;case"time":i=this._processTimeColumn(t);break;case"text":i=this._processTextColumn(t);break;case"label":i=this._processLabelColumn(t);break;case"number":i=this._processNumberColumn(t);break;case"percentage":i=this._processPercentageColumn(t);break;case"bool":i=this._processBooleanColumn(t);break;default:n.error(e.UNKNOWN_FENIX_COLUMN_DATATYPE,t.dataType.toLowerCase())}else n.error(e.INVALID_FENIX_COLUMN);return o.extend(!0,{},i,this._commonProcessColumn(t))},a.prototype._processCustomCodeColumn=function(e){return this._configTreeFromSource(e)},a.prototype._processEnumerationColumn=function(e){var t={},o=e.domain||{},n=o.enumeration||[];return t.selector={},t.selector.id="tree",t.selector.hideFilter=!0,t.selector.source=r.map(n,function(e){return{value:e,label:e}}),t},a.prototype._processCodeColumn=function(e,t){return this._configTreeFromDistinct(e,t)},a.prototype._processDateColumn=function(e){var t=e.domain||{},o=t.period,r=t.timeList;return o&&o.from&&o.to?this._configTimeFromPeriod(e):r?this._configTreeFromTimelist(e):(n.warn("Impossible to find process for column "+e.id),{})},a.prototype._processMonthColumn=function(e){return this._configTemporalColumn(e)},a.prototype._processYearColumn=function(e){return this._configTemporalColumn(e)},a.prototype._processTimeColumn=function(e){return this._configTemporalColumn(e)},a.prototype._processTextColumn=function(e){return this._configInput(e,{type:"text"})},a.prototype._processLabelColumn=function(e){return this._configInput(e,{type:"text"})},a.prototype._processNumberColumn=function(e){return this._configInput(e,{type:"number",output:"time"})},a.prototype._processPercentageColumn=function(e){n.warn("TODO process")},a.prototype._processBooleanColumn=function(e){return this._configInput(e,{type:"checkbox"})},a.prototype._commonProcessColumn=function(e){var t={template:{},format:{dimension:e.id}};return e.title&&e.title[this.lang.toUpperCase()]&&(t.template.title=e.title[this.lang.toUpperCase()]),t},a.prototype._configTreeFromDistinct=function(e,t){var o,r={},i=e.domain||{},s=i.codes;return(!Array.isArray(s)||s.length>1)&&n.warn("Invalid domain.codes attributes"),o=s[0],o.idCodeList||n.error("Impossible to find idCodeList"),r.distinct={uid:t.uid,version:t.version,columnId:e.id},r.selector={},r.selector.id="tree",r},a.prototype._configTreeFromCodelist=function(e){var t,o={},r=e.domain||{},i=r.codes;return(!Array.isArray(i)||i.length>1)&&n.warn("Invalid domain.codes attributes"),t=i[0],t.idCodeList||n.error("Impossible to find idCodeList"),o.cl={},o.cl.uid=t.idCodeList,o.cl.version=t.version,o.selector={},o.selector.id="tree",o.selector.lazy=!0,o.selector.hideFilter=!0,o},a.prototype._configTreeFromSource=function(e){var t,o={},i=e.domain||{},s=i.codes;return(!Array.isArray(s)||s.length>1)&&n.warn("Invalid domain.codes attributes"),t=s[0],t.codes||n.error("Impossible to find codes"),o.selector={},o.selector.id="tree",o.selector.source=r.map(t.codes,r.bind(function(e){return{value:e.code,label:e.label[this.lang.toUpperCase()]}},this)),o.selector.hideFilter=!0,o},a.prototype._configDropdownFromPeriod=function(e){var t={},o=e.domain||{},r=o.period;return t.selector={},t.selector.id="dropdown",t.selector.from=r.from,t.selector.to=r.to,t},a.prototype._configTreeFromPeriod=function(e){var t={},o=e.domain||{},r=o.period;return t.selector={},t.selector.id="tree",t.selector.from=r.from,t.selector.to=r.to,t.selector.hideFilter=!0,t},a.prototype._configDropdownFromTimelist=function(e){var t={},o=e.domain||{},n=o.timeList||[],i=this._getTimeFormat(n[0]);return t.selector={},t.selector.id="dropdown",t.selector.source=r.map(n,r.bind(function(e){return{value:e,label:new s(e,i).format(this._getTimeLabelFormat(e))}},this)),t},a.prototype._configTreeFromTimelist=function(e){var t={},o=e.domain||{},n=o.timeList||[],i=this._getTimeFormat(n[0]);return t.selector={},t.selector.id="tree",t.selector.source=r.map(n,r.bind(function(e){return{value:e,label:new s(e,i).format(this._getTimeLabelFormat(e))}},this)),t.selector.hideFilter=!0,t},a.prototype._configDropdownFromSource=function(e){var t,o={},i=e.domain||{},s=i.codes;return(!Array.isArray(s)||s.length>1)&&n.warn("Invalid domain.codes attributes"),t=s[0],t.codes||n.error("Impossible to find codes"),o.selector={},o.selector.id="dropdown",o.selector.source=r.map(t.codes,r.bind(function(e){return{value:e.code,label:e.label[this.lang.toUpperCase()]}},this)),o},a.prototype._configDropdownFromCodelist=function(e){var t,o={},r=e.domain||{},i=r.codes;return(!Array.isArray(i)||i.length>1)&&n.warn("Invalid domain.codes attributes"),t=i[0],t.idCodeList||n.error("Impossible to find idCodeList"),o.cl={},o.cl.uid=t.idCodeList,o.cl.version=t.version,o.selector={},o.selector.id="dropdown",o},a.prototype._configTimeFromPeriod=function(e){var t={},o=e.domain||{},r=o.period,n=String(r.from),i=String(r.to);return t.selector={config:{}},t.selector.id="tree",t.selector.from=parseInt(n,10),t.selector.to=parseInt(i,10),t.selector.hideFilter=!0,t.format={output:"time"},t},a.prototype._configRangeFromPeriod=function(e){var t={},o=e.domain||{},r=o.period;return t.selector={config:{}},t.selector.id="range",t.selector.config.min=r.from,t.selector.config.max=r.to,t.selector.config.type="double",t.selector.config.prettify_enabled=!1,t},a.prototype._configInput=function(e,t){var o={selector:{},format:{output:t.output||"enumeration"}};return o.selector.id="input",o.selector.type=t.type||"text",o},a.prototype._configTemporalColumn=function(e){var o=e.domain||{},r=o.period,i=o.timeList;return r&&r.from&&r.to?this._configTreeFromPeriod(e):i?this._configTreeFromTimelist(e):(n.warn("Column "+e.id+" set with default time period range."),e.domain={period:{from:t.defaultPeriodFrom,to:t.defaultPeriodTo}},this._configTimeFromPeriod(e))},a.prototype._getTimeFormat=function(e){var t;switch(String(e).length){case 4:t="YYYY";break;case 6:t="YYYY MM";break;case 8:t="YYYY MM DD";break;case 12:t="YYYY MM DD hh mm";break;case 14:t="YYYY MM DD hh mm ss";break;default:n.warn("Impossible to find time format for: "+t)}return t},a.prototype._getTimeLabelFormat=function(e){if(this.timeLabelFormat)return this.timeLabelFormat;var t;switch(String(e).length){case 4:t="YYYY";break;case 6:t="L";break;case 8:t="L";break;case 14:t="lll";break;default:n.warn("Impossible to find time label format for: "+t)}return t},a.prototype._isFenixResource=function(t){var o=!0,r=[],n=this.getNestedProperty("metadata.meContent.resourceRepresentationType",t);return t.hasOwnProperty("metadata")||(r.push({code:e.INVALID_METADATA}),o=!1),o&&!t.metadata.hasOwnProperty("dsd")&&(r.push({code:e.INVALID_DSD}),o=!1),"dataset"!==n||!o||t.metadata.dsd.hasOwnProperty("columns")&&Array.isArray(t.metadata.dsd.columns)||r.push({code:e.INVALID_COLUMNS}),r.length>0?r:o},a.prototype._isFenixColumn=function(t){var o=!0,r=[];return t.hasOwnProperty("dataType")||(r.push({code:e.INVALID_COLUMN_DATATYPE}),o=!1),r.length>0?r:o},a.prototype.getNestedProperty=function(e,t){for(var t=r.extend({},t),o=e.split(".");o.length&&(t=t[o.shift()]););return t},a.prototype.assign=function(e,t,o){if("string"==typeof t&&(t=t.split(".")),t.length>1){var r=t.shift();this.assign(e[r]="[object Object]"===Object.prototype.toString.call(e[r])?e[r]:{},t,o)}else e[t[0]]=o},a.prototype.getNestedProperty=function(e,t){for(var t=r.extend({},t),o=e.split(".");o.length&&(t=t[o.shift()]););return t},new a}.apply(t,r),!(void 0!==n&&(e.exports=n))},function(e,t,o){var r;r=function(){"use strict";var e="";return{INVALID_FENIX_RESOURCE:e+"invalid_fenix_resource",INVALID_METADATA:e+"invalid_metadata",INVALID_DSD:e+"invalid_dsd",INVALID_COLUMNS:e+"invalid_dsd",INVALID_FENIX_COLUMN:e+"invalid_fenix_column",INVALID_COLUMN_DATATYPE:e+"invalid_column_datatype",UNKNOWN_FENIX_COLUMN_DATATYPE:e+"unknown_fenix_column_datatype"}}.call(t,o,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,o){var r;r=function(){"use strict";return{forbiddenSubjects:["value"],exclude:[],common:{},lang:"EN",defaultPeriodFrom:1970,defaultPeriodTo:2017}}.call(t,o,t,e),!(void 0!==r&&(e.exports=r))},function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t){e.exports=o},function(e,t){e.exports=r},function(e,t){e.exports=n}])});
//# sourceMappingURL=fenix-ui-filter-utils.min.js.map